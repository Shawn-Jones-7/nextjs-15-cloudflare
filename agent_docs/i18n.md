# Internationalization (i18n)

## Overview

This project uses next-intl for internationalization with locale-prefixed URLs and browser language detection.

## Configuration

| Setting | Value |
|---------|-------|
| Library | next-intl ^4.5 |
| Locales | `en` (default), `zh`, `es`, `ar` |
| Prefix Mode | `always` (all URLs have locale prefix) |
| RTL Support | Arabic (`ar`) uses `dir="rtl"` |
| Detection | URL > Cookie > Accept-Language > Default |

## URL Routing

### Locale Prefix Strategy: `always`

All URLs include the locale prefix:

```
/en              → English home
/zh              → Chinese home
/es              → Spanish home
/ar              → Arabic home (RTL)
/en/products     → English products
/zh/products     → Chinese products
/en/products/industrial-valves  → Product detail (same slug all locales)
```

### Root Path Behavior

When user visits `/`:
1. Check `NEXT_LOCALE` cookie (previous selection)
2. Check `Accept-Language` header (browser preference)
3. Fallback to `en` (default)
4. Redirect to `/{detected-locale}`

### Slug Strategy

Product and blog slugs are **NOT translated**:
```
/en/products/industrial-valves  →  English content
/zh/products/industrial-valves  →  Chinese content (same slug)
/ar/products/industrial-valves  →  Arabic content (same slug)
```

## Translation Files

```
messages/
├── en.json    # English (default)
├── zh.json    # Chinese
├── es.json    # Spanish
└── ar.json    # Arabic (RTL)
```

### Message Structure

```json
{
  "Site": {
    "brandName": "GlobalTrade",
    "contact": { "address": "...", "phone": "...", "email": "..." },
    "social": { "linkedin": "...", "twitter": "..." }
  },
  "Navigation": {
    "home": "Home",
    "products": "Products",
    "blog": "Blog",
    "about": "About",
    "contact": "Contact",
    "categories": {
      "electronics": "Electronics",
      "machinery": "Machinery"
    }
  },
  "HomePage": { "title": "...", "description": "...", "cta": "..." },
  "ProductsPage": { "title": "...", "categories": { ... } },
  "ContactPage": { "title": "...", "form": { ... } },
  "Footer": { "description": "...", "copyright": "...", "themeToggle": "..." },
  "Common": { "backToTop": "Back to top", "loading": "Loading..." }
}
```

## Using Translations

### Server Components

```typescript
import { getTranslations } from 'next-intl/server';

export default async function Page({ params }: PageProps) {
  const { locale } = await params;
  const t = await getTranslations({ locale, namespace: 'HomePage' });

  return <h1>{t('title')}</h1>;
}
```

### Client Components

```typescript
'use client';
import { useTranslations } from 'next-intl';

export function Header() {
  const t = useTranslations('Navigation');
  const site = useTranslations('Site');

  return <span>{site('brandName')}</span>;
}
```

### Nested Keys

```typescript
// Access nested: Site.contact.phone
const site = useTranslations('Site');
site('contact.phone');  // "+1 (555) 123-4567"
```

## Language Switching

### LocaleSwitcher Component

Uses next-intl's `useRouter` to switch locales:

```typescript
import { useRouter, usePathname } from '@/lib/i18n/routing';

function onSelectChange(event: ChangeEvent<HTMLSelectElement>) {
  const nextLocale = event.target.value;
  startTransition(() => {
    router.replace(pathname, { locale: nextLocale });
  });
}
```

### Cookie Persistence

When user switches language:
1. URL changes to new locale prefix
2. `NEXT_LOCALE` cookie is set automatically
3. Subsequent visits to `/` redirect to saved locale

## RTL Support (Arabic)

### HTML Direction

Set in `app/[locale]/layout.tsx`:

```typescript
import { isRtl } from '@/lib/i18n/config';

const direction = isRtl(locale) ? 'rtl' : 'ltr';
<html lang={locale} dir={direction}>
```

### CSS Logical Properties

**Always use logical properties** instead of physical directions:

```tsx
// ❌ Wrong: Physical properties (breaks RTL)
<div className="ml-4 mr-8 left-0 text-left">

// ✅ Correct: Logical properties (RTL-safe)
<div className="ms-4 me-8 start-0 text-start">
```

| Physical | Logical | Description |
|----------|---------|-------------|
| `ml-*` | `ms-*` | Margin inline-start |
| `mr-*` | `me-*` | Margin inline-end |
| `pl-*` | `ps-*` | Padding inline-start |
| `pr-*` | `pe-*` | Padding inline-end |
| `left-*` | `start-*` | Inset inline-start |
| `right-*` | `end-*` | Inset inline-end |
| `text-left` | `text-start` | Text alignment |
| `text-right` | `text-end` | Text alignment |

### Mixed Content

For LTR content in RTL pages (e.g., English brand names):

```tsx
<span dir="ltr" className="inline-block">Product XYZ-2000</span>
```

## SEO Configuration

### hreflang Tags

Generated in `generateMetadata` for each page:

```typescript
export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { locale } = await params;
  const pathname = '/products';
  const baseUrl = 'https://example.com';

  return {
    alternates: {
      canonical: `${baseUrl}/${locale}${pathname}`,
      languages: {
        en: `${baseUrl}/en${pathname}`,
        zh: `${baseUrl}/zh${pathname}`,
        es: `${baseUrl}/es${pathname}`,
        ar: `${baseUrl}/ar${pathname}`,
        'x-default': `${baseUrl}/en${pathname}`,
      },
    },
  };
}
```

### Sitemap

Generate all locale variants for each page in `sitemap.ts`.

## Adding New Translations

1. Add keys to **all 4 locale files** with identical structure
2. Use namespace organization: `Namespace.section.key`
3. Run `pnpm typecheck` to verify
4. Test RTL rendering for Arabic

## Key Files

| File | Purpose |
|------|---------|
| `src/lib/i18n/config.ts` | Locale list, labels, RTL detection |
| `src/lib/i18n/routing.ts` | Route definition, navigation helpers |
| `src/i18n/request.ts` | Message loading configuration |
| `src/middleware.ts` | Locale detection and routing |
| `messages/*.json` | Translation files |
| `app/[locale]/layout.tsx` | Locale provider setup |

## Detection Priority

```
1. URL Path        /zh/products      → zh (explicit)
2. Cookie          NEXT_LOCALE=zh    → zh (remembered)
3. Accept-Language zh-CN,en;q=0.9    → zh (browser)
4. Default                           → en (fallback)
```
