# 项目技术栈

## 1. 核心框架

### 前端框架
- **Next.js 15.3.2** - React 全栈框架，App Router 架构
- **React 19.1.0** - 用户界面库，支持服务器组件
- **TypeScript 5.8.3** - 类型安全的 JavaScript 超集
- **Tailwind CSS 4.1.7** - 原子化 CSS 框架（CSS-first 配置）

### 渲染策略
- **SSG + ISR** - 静态生成 + 增量静态再生
- **Server Actions** - 服务器端表单处理和数据变更
- **Edge Runtime** - Cloudflare Workers 边缘计算

### 部署平台
- **Cloudflare Workers** - 边缘计算运行时
- **@opennextjs/cloudflare 1.0.4** - Next.js Cloudflare 适配器
- **Wrangler 4.16.1** - Cloudflare CLI 工具

## 2. 内容管理系统

### MDX 内容管理
- **Velite 0.3.1** - 类型安全的 MDX 内容管理框架
- **@mdx-js/loader 3.1.1** - MDX 文件加载器
- **@mdx-js/react 3.1.1** - React 组件嵌入支持
- **gray-matter 4.0.3** - Front Matter 解析
- **@types/mdx 2.0.13** - MDX 类型定义

### 目录结构
```
src/content/
├── en/blog/        # 英文博客内容
├── zh/blog/        # 中文博客内容
├── es/blog/        # 西班牙语博客内容
└── ar/blog/        # 阿拉伯语博客内容

.velite/            # Velite 生成的类型安全数据
```

### 核心特性
- **类型安全** - Velite 自动生成 TypeScript 类型
- **多语言内容** - 四语言 MDX 内容同步管理
- **Schema 验证** - 使用 Velite schema 验证 Front Matter
- **增量构建** - 开发模式下 watch 模式自动重建

## 3. Cloudflare 集成

### 绑定资源
| 类型 | 绑定名称 | 用途 | 状态 |
|------|----------|------|------|
| D1 | `NEXT_TAG_CACHE_D1` | Next.js 标签缓存 | 已启用 |
| D1 | `CONTACT_FORM_D1` | 联系表单数据存储 | 已启用 |
| KV | `NEXT_INC_CACHE_KV` | 增量缓存存储 | 已启用 |
| Queue | `lead-notifications` | 异步通知队列 | 待启用 |

### OpenNext 配置
```typescript
// open-next.config.ts
{
  incrementalCache: kvIncrementalCache,  // KV 增量缓存
  tagCache: d1TagCache,                  // D1 标签缓存
  queue: memoryQueue,                    // 内存队列（生产可切换）
  enableCacheInterception: true,
}
```

## 4. UI 设计系统

### 组件库
- **shadcn/ui** - 现代化 UI 组件库（New York 风格）
- **@radix-ui/react-*** - 无障碍组件基础库
  - dialog 1.1.15 - 模态对话框
  - dropdown-menu 2.1.16 - 下拉菜单
  - navigation-menu 1.2.14 - 导航菜单
  - select 2.2.6 - 选择器
  - slot 1.2.4 - 组件插槽系统
- **class-variance-authority 0.7.1** - 样式变体管理
- **clsx 2.1.1 + tailwind-merge 3.3.0** - 条件类名合并
- **lucide-react 0.510.0** - SVG 图标库
- **sonner 2.0.7** - 通知系统
- **next-nprogress-bar 2.4.7** - 页面加载进度条

### 主题与动画
- **next-themes 0.4.6** - 主题切换（系统/明亮/暗黑）
- **Tailwind CSS 动画** - 主要动画方案（性能优先）
  - tw-animate-css 1.3.0 - 动画扩展
- **CSS 变量主题系统** - OKLCH 色彩空间，动态主题切换

### 表单与验证
- **React 19 原生表单** - 使用 Server Actions
  - useActionState - 表单状态管理
  - useFormStatus - 表单子组件中访问提交状态
  - Server Actions - 服务端表单处理，类型安全的数据提交
- **Zod 4.1.13** - TypeScript 模式验证和数据校验
- **ArkType 2.1.20** - 运行时类型验证（环境变量）

## 5. 开发工具链

### 代码质量
- **eslint 9.27.0** - 代码质量检查（Flat Config）
  - @eslint/eslintrc 3.3.1 - ESLint 配置兼容层
  - @eslint/js 9.27.0 - ESLint JavaScript 配置
- **typescript-eslint 8.32.1** - TypeScript 专用规则
- **@eslint-react/eslint-plugin 1.49.0** - React 组件规则
- **eslint-plugin-react-hooks 6.0.0-rc.1** - React Hooks 最佳实践
- **eslint-plugin-react-you-might-not-need-an-effect 0.7.0** - useEffect 优化
- **@next/eslint-plugin-next 15.3.2** - Next.js 专用规则
- **eslint-plugin-import-x 4.13.0** - 导入语句规则
- **eslint-plugin-jsx-a11y 6.10.2** - 无障碍性规则
- **eslint-config-prettier 10.1.5** - Prettier 冲突解决
- **eslint-plugin-security 3.0.1** - 安全规则检查
- **eslint-plugin-unicorn 59.0.1** - 代码风格最佳实践
- **eslint-plugin-n 17.18.0** - Node.js 规则
- **eslint-plugin-drizzle 0.2.3** - Drizzle ORM 规则
- **eslint-config-next 15.3.2** - Next.js ESLint 配置预设

### 代码格式化
- **prettier 3.5.3** - 代码格式化核心
- **@ianvs/prettier-plugin-sort-imports 4.4.1** - 导入排序
- **prettier-plugin-tailwindcss 0.6.11** - Tailwind CSS 类名排序
- **prettier-plugin-packagejson 2.5.14** - package.json 排序

### 构建工具
- **Turbopack** - 开发环境构建（`next dev --turbopack`）
- **pnpm 10.11.0** - 包管理器
- **@lhci/cli 0.15.1** - Lighthouse CI 性能监控
- **dependency-cruiser 17.3.2** - 依赖分析
- **madge 8.0.0** - 循环依赖检测
- **knip 5.72.0** - 未使用代码检测
- **jscpd 4.0.5** - 代码重复检测
- **cspell 9.0.2** - 拼写检查
- **markdownlint-cli2 0.18.0** - Markdown 格式检查

### Git 工作流
- **lefthook 1.11.13** - Git hooks 管理
- **@commitlint/cli 19.8.1** - 提交信息规范
- **@commitlint/config-conventional 19.8.1** - 约定式提交
- **commitizen 4.3.1** - 交互式提交
- **@changesets/cli 2.29.4** - 版本管理

### TypeScript 配置
- **@types/node 22.15.21** - Node.js 类型定义
- **@types/react 19.1.5** - React 19 类型定义
- **@types/react-dom 19.1.5** - React DOM 类型定义
- **@total-typescript/ts-reset 0.6.1** - TypeScript 类型增强

### TypeScript 严格检查
```json
{
  "strict": true,
  "strictNullChecks": true,
  "noUnusedLocals": true,
  "noUnusedParameters": true,
  "noUncheckedIndexedAccess": true,
  "noImplicitReturns": true,
  "noFallthroughCasesInSwitch": true,
  "noImplicitOverride": true,
  "allowUnusedLabels": false,
  "allowUnreachableCode": false
}
```

## 6. 测试框架

### 单元测试
- **vitest 3.2.4** - 现代化测试框架
- **@vitest/browser 3.2.4** - 浏览器测试
- **@vitejs/plugin-react 4.5.0** - React 支持
- **vitest-browser-react 0.1.1** - React 浏览器测试工具
- **vite-tsconfig-paths 5.1.4** - 路径别名支持

### 端到端测试
- **@playwright/test 1.52.0** - 端到端测试框架
- **playwright 1.52.0** - Playwright 核心库

### Playwright 配置
| 配置项 | 值 |
|--------|-----|
| 测试目录 | `e2e/` |
| 浏览器 | chromium, firefox, webkit |
| 移动端 | Pixel 5, iPhone 12 |
| CI 重试 | 2 次 |
| 追踪 | `on-first-retry` |

## 7. 安全与环境

### 安全防护
- **@marsidev/react-turnstile 1.3.1** - Cloudflare Turnstile 机器人防护
- **Next.js 安全头配置** - CSP、X-Frame-Options 等
- **Next.js Middleware** - 中间件安全防护

### 环境变量
- **@t3-oss/env-nextjs 0.13.4** - 类型安全环境变量
- **ArkType 2.1.20** - 运行时环境变量验证
- **dotenv 16.5.0** - 环境变量加载

## 8. 国际化与 SEO

### 国际化
- **next-intl 4.5.8** - Next.js 国际化框架
- **支持语言** - 英语(en)、中文(zh)、西班牙语(es)、阿拉伯语(ar)
- **RTL 支持** - 阿拉伯语自动右到左布局
- **URL 前缀模式** - 所有 URL 都有语言前缀

### SEO 优化
- **Next.js 15 Metadata API** - 原生 SEO 优化
- **robots.ts / sitemap.ts** - 动态生成 robots 和 sitemap
- **结构化数据** - Schema.org JSON-LD 支持

## 9. 项目架构

### 目录结构
```
src/
├── app/[locale]/       # Next.js 15 App Router + 国际化
│   ├── page.tsx       # 首页
│   ├── layout.tsx     # 根布局
│   ├── blog/          # 博客页面
│   ├── products/      # 产品页面
│   ├── contact/       # 联系页面
│   ├── about/         # 关于页面
│   ├── cases/         # 案例页面
│   └── news/          # 新闻页面
├── components/         # 组件库分层
│   ├── ui/            # shadcn/ui 基础组件
│   ├── layout/        # 布局组件
│   ├── forms/         # 表单组件
│   ├── blog/          # 博客组件
│   ├── products/      # 产品组件
│   ├── sections/      # 页面区块组件
│   ├── common/        # 通用组件
│   ├── i18n/          # 国际化组件
│   ├── seo/           # SEO 组件
│   └── whatsapp/      # WhatsApp 集成
├── lib/               # 工具库
│   ├── api/           # API 客户端
│   ├── d1/            # D1 数据库
│   ├── i18n/          # 国际化配置
│   ├── schemas/       # 数据模式
│   └── turnstile/     # Turnstile 验证
├── actions/           # Server Actions
├── content/           # MDX 内容
├── data/              # 静态数据
├── i18n/              # next-intl 配置
├── queue/             # Queue 消费者
└── middleware.ts      # 中间件

messages/              # next-intl 翻译文件
config/                # 工具配置文件
e2e/                   # E2E 测试
```

### 设计系统
- **主题系统** - Light/Dark/System 三模式切换
- **色彩空间** - OKLCH 色彩空间
- **组件库** - shadcn/ui New York 风格
- **命名规范** - 组件：PascalCase，文件：kebab-case，变量：camelCase

## 10. 配置与最佳实践

### 核心配置文件
| 文件 | 用途 |
|------|------|
| `eslint.config.js` | ESLint 9 Flat Config |
| `next.config.ts` | Next.js 配置（集成 next-intl、Velite） |
| `tsconfig.json` | TypeScript 严格配置 |
| `wrangler.toml` | Cloudflare Workers 配置 |
| `open-next.config.ts` | OpenNext 缓存配置 |
| `velite.config.ts` | Velite MDX 内容配置 |
| `vitest.config.ts` | Vitest 测试配置 |
| `playwright.config.ts` | Playwright E2E 配置 |
| `components.json` | shadcn/ui 组件库配置 |
| `lefthook.yml` | Git hooks 配置 |

### 代码质量标准
- **复杂度限制** - 最大复杂度 15，嵌套深度 3
- **函数长度** - 最大 120 行，参数不超过 3 个
- **文件大小** - 最大 500 行

### 开发工作流
```bash
# 开发环境
pnpm dev                    # 启动开发服务器（Turbopack）

# 代码质量检查
pnpm typecheck             # TypeScript 类型检查
pnpm lint                  # ESLint 代码检查（零警告）
pnpm format:check          # Prettier 格式检查
pnpm lint:unused           # 未使用代码检测
pnpm lint:dup              # 重复代码检测
pnpm lint:deps             # 依赖分析
pnpm lint:security         # 安全规则检查
pnpm circular:check        # 循环依赖检测

# 测试
pnpm test                  # 运行单元测试
pnpm test:browser          # 浏览器测试（带 UI）
pnpm test:e2e              # 端到端测试

# 构建与部署
pnpm build                 # 生产环境构建
pnpm preview               # 本地预览
pnpm deploy                # 部署到 Cloudflare
```

## 11. 运行环境要求

### 最低版本
- **Node.js** >= 22
- **pnpm** >= 10

### Volta 锁定版本
```json
{
  "node": "22.15.0",
  "pnpm": "10.10.0"
}
```
